<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">


    <style>
        
        canvas {
            border: 0;
            background-image: url("grass.png");
            background-size: 10000000000;
            background-position: center center;
            position: fixed;
        }
    </style>

</head>

<body onload="startGame()">
    <script>
        var user;
        function startGame() {
            gameMap.start();
            user = new avatar(50, 50, "red", 100, 120);
        }

        var gameMap = {
            canvas: document.createElement("canvas"),
            start: function () {
                this.canvas.width = innerWidth;
                this.canvas.height = innerHeight;
                this.context = this.canvas.getContext("2d");
                document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                this.interval = setInterval(updateMap, 20);
                
                window.addEventListener('keydown', function (e) {
                    gameMap.keys = (gameMap.keys || []);
                    gameMap.keys[e.keyCode] = true;
                })
                window.addEventListener('keyup', function (e) {
                    gameMap.keys[e.keyCode] = false;
                })
                window.addEventListener('keypressed', function (e) {
                    gameMap.keys[e.keyCode] = true;
                })
            },

            clear: function () {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            }
        }

        function avatar(width, height, color, xpos, ypos) {
            this.gameMap = gameMap;
            this.width = width;
            this.height = height;
            this.speedX = 0;
            this.speedY = 0;
            this.xpos = xpos;
            this.ypos = ypos;
            this.update = function () {
                ctx = gameMap.context;
                ctx.fillStyle = color;
                ctx.fillRect(this.xpos, this.ypos, this.width, this.height);
            }
            this.newPos = function () {
                this.xpos += this.speedX;
                this.ypos += this.speedY;
            }


        }

        function updateMap() {
            gameMap.clear();
            user.speedX = 0;
            user.speedY = 0;
            speedFactor = 1;
            
            if (gameMap.keys && gameMap.keys[16]) { speedFactor = 3; }
            if (gameMap.keys && gameMap.keys[37]) { user.speedX = -2 * speedFactor; }
            if (gameMap.keys && gameMap.keys[39]) { user.speedX = 2 * speedFactor; }
            if (gameMap.keys && gameMap.keys[38]) { user.speedY = -2 * speedFactor; }
            if (gameMap.keys && gameMap.keys[40]) { user.speedY = 2 * speedFactor; }
            user.newPos();
            user.update();
        }

    </script>

</body>